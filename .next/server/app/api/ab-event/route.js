"use strict";(()=>{var e={};e.id=635,e.ids=[635],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},4770:e=>{e.exports=require("crypto")},5315:e=>{e.exports=require("path")},4151:(e,t,r)=>{r.r(t),r.d(t,{originalPathname:()=>A,patchFetch:()=>x,requestAsyncStorage:()=>f,routeModule:()=>v,serverHooks:()=>y,staticGenerationAsyncStorage:()=>w});var s={};r.r(s),r.d(s,{POST:()=>h});var a=r(9303),o=r(8716),n=r(670);let i=require("fs/promises");var p=r.n(i),c=r(5315),u=r.n(c),l=r(4770),d=r(7070);async function m(e,t,r){let s=u().resolve(process.cwd(),"data","ab-events.json"),a=[];try{let e=await p().readFile(s,"utf-8");a=JSON.parse(e||"[]")}catch(e){"ENOENT"!==e.code&&console.error("Read error:",e)}a.push({slug:e,variant:t,eventType:r,timestamp:new Date().toISOString()});try{await p().writeFile(s,JSON.stringify(a,null,2),"utf-8")}catch(e){console.error("Write error:",e)}let o=process.env.GA_MEASUREMENT_ID,n=process.env.GA_API_SECRET;if(o&&n){let s=async(a=1)=>{try{let s=(0,l.randomUUID)(),a=await fetch(`https://www.google-analytics.com/mp/collect?measurement_id=${o}&api_secret=${n}`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({client_id:s,events:[{name:"ab_event",params:{slug:e,variant:t,eventType:r}}]})});if(!a.ok)throw Error(`GA4 responded with status ${a.status}`)}catch(t){let e=t?.cause?.code||t.code;if(("EAI_AGAIN"===e||"EAGAIN"===e)&&a<3)return await new Promise(e=>setTimeout(e,100*a)),s(a+1);console.error(`GA4 forward error (attempt ${a}):`,t)}};s()}}async function h(e){let t;try{t=await e.json()}catch{return d.NextResponse.json({error:"Invalid JSON"},{status:400})}let{slug:r,variant:s,eventType:a}=t;return r&&s&&a?(m(r,s,a),d.NextResponse.json({success:!0})):d.NextResponse.json({error:"Missing fields"},{status:400})}let v=new a.AppRouteRouteModule({definition:{kind:o.x.APP_ROUTE,page:"/api/ab-event/route",pathname:"/api/ab-event",filename:"route",bundlePath:"app/api/ab-event/route"},resolvedPagePath:"/Users/thomasjacques/Desktop/SITEFIXED/shopify-headless-complete/app/api/ab-event/route.ts",nextConfigOutput:"standalone",userland:s}),{requestAsyncStorage:f,staticGenerationAsyncStorage:w,serverHooks:y}=v,A="/api/ab-event/route";function x(){return(0,n.patchFetch)({serverHooks:y,staticGenerationAsyncStorage:w})}}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),s=t.X(0,[948,972],()=>r(4151));module.exports=s})();